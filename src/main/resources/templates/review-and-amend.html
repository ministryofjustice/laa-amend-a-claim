<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout :: layout(
        title=#{claimReview.title},
        mainContent=~{::#main-content},
        pageCategory=${null},
        showBackLink=${true},
        backLinkUrl=@{/submissions/{submissionId}/claims/{claimId}/assessment-outcome(submissionId=${submissionId}, claimId=${claimId})}
    )}">
<body>
<main class="govuk-main-wrapper" id="main-content">

    <th:block th:if="${validationFailed}">
        <th:block th:replace="~{partials/error-summary :: error-summary(${viewModel.errors})}"></th:block>
    </th:block>

    <th:block th:if="${submissionFailed}">
        <th:block th:replace="~{partials/error-alert :: errorAlert('claimReview')}"></th:block>
    </th:block>

    <h1 class="govuk-heading-xl">
        <span th:text="#{claimReview.mainHeading}"></span>
    </h1>

    <p class="govuk-body">
        <strong th:text="#{claimReview.assessmentOutcome} "></strong>
        <span th:text="#{${(claim.assessmentOutcome != null) ? claim.assessmentOutcome.messageKey : 'claimValuesTable.noData'}}"></span>
    </p>

    <div class="govuk-summary-card">
        <div class="govuk-summary-card__title-wrapper">
            <h2 class="govuk-summary-card__title" th:text="#{claimSummary.claimCostsTableTitle}"/>
        </div>
        <div class="govuk-summary-card__content">

            <table class="govuk-table govuk-!-margin-bottom-0">
                <colgroup>
                    <col class="govuk-table__row-item">
                    <col class="govuk-table__row-values">
                    <col class="govuk-table__row-values">
                    <col class="govuk-table__row-values">
                    <col class="govuk-table__row-actions">
                </colgroup>
                <thead class="govuk-table__head">
                <tr class="govuk-table__row">
                    <th scope="col" class="govuk-table__header" th:text="#{claimSummary.item}"></th>
                    <th scope="col" class="govuk-table__header" th:text="#{claimSummary.calculated}"></th>
                    <th scope="col" class="govuk-table__header" th:text="#{claimSummary.submitted}"></th>
                    <th scope="col" class="govuk-table__header" th:text="#{claimSummary.assessed}"></th>
                    <th scope="col" class="govuk-table__header"></th>
                </tr>
                </thead>
                <tbody class="govuk-table__body">
                <tr class="govuk-table__row" th:each="row : ${viewModel.reviewClaimFieldRows}">

                    <td class="govuk-table__cell govuk-!-font-weight-bold" th:text="#{${row.label}}" />

                    <td class="govuk-table__cell" th:text="${@ThymeleafUtils.getFormattedValue(row.calculated).resolve(#messages)}"/>

                    <td class="govuk-table__cell" th:text="${@ThymeleafUtils.getFormattedValue(row.submitted).resolve(#messages)}"/>

                    <td class="govuk-table__cell">

                        <a th:if="${row.isAssessableAndUnassessed}"
                           th:href="${row.getChangeUrl(submissionId, claimId)}"
                           th:id="${row.id}"
                           th:data-testid="${'claim-field-' + row.key}"
                           class="govuk-link govuk-link--no-visited-state">
                            <th:block th:text="#{service.add}"></th:block>
                            <span class="govuk-visually-hidden" th:text="| #{${row.label}}|"></span>
                        </a>

                        <span th:if="${!row.isAssessableAndUnassessed}"
                              th:text="${@ThymeleafUtils.getFormattedValue(row.assessed).resolve(#messages)}"/>
                    </td>

                    <td class="govuk-table__cell">
                        <a th:if="${row.isAssessableAndAssessed and row.getChangeUrl(submissionId, claimId) != null}"
                           th:href="${row.getChangeUrl(submissionId, claimId)}"
                           th:data-testid="${'claim-field-' + row.key}"
                           class="govuk-link govuk-link--no-visited-state">
                            <th:block th:text="#{service.change}"></th:block>
                            <span class="govuk-visually-hidden" th:text="| #{${row.label}}|"></span>
                        </a>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div class="govuk-summary-card" th:unless="${viewModel.assessedTotals.isEmpty()}">
        <div class="govuk-summary-card__title-wrapper">
            <h2 class="govuk-summary-card__title" th:text="#{claimSummary.assessedTotalsTableTitle}"/>
        </div>
        <div class="govuk-summary-card__content">
            <table class="govuk-table govuk-!-margin-bottom-0">
                <colgroup>
                    <col class="govuk-table__row-item">
                    <col class="govuk-table__row-values">
                    <col class="govuk-table__row-values">
                    <col class="govuk-table__row-values">
                    <col class="govuk-table__row-actions">
                </colgroup>

                <thead class="govuk-table__head">
                <tr class="govuk-table__row">
                    <th scope="col" class="govuk-table__header" th:text="#{claimSummary.item}"></th>
                    <th scope="col" class="govuk-table__header" th:text="#{claimSummary.calculated}"></th>
                    <th scope="col" class="govuk-table__header" th:text="#{claimSummary.submitted}"></th>
                    <th scope="col" class="govuk-table__header" th:text="#{claimSummary.assessed}"></th>
                    <th scope="col" class="govuk-table__header"></th>
                </tr>
                </thead>
                <tbody class="govuk-table__body">
                <tr class="govuk-table__row" th:each="row : ${viewModel.assessedTotals}">

                    <td class="govuk-table__cell govuk-!-font-weight-bold"
                        th:text="#{${row.label}}">
                    </td>

                    <td class="govuk-table__cell"
                        th:text="${@ThymeleafUtils.getFormattedValue(row.calculated).resolve(#messages)}">
                    </td>

                    <td class="govuk-table__cell"
                        th:text="${@ThymeleafUtils.getFormattedValue(row.submitted).resolve(#messages)}">
                    </td>

                    <td class="govuk-table__cell">

                        <a th:if="${row.isAssessableAndUnassessed}"
                           th:href="${row.getChangeUrl(submissionId, claimId)}"
                           th:id="${row.id}"
                           th:data-testid="${'totals-' + row.key}"
                           class="govuk-link govuk-link--no-visited-state">
                            <th:block th:text="#{service.add}"></th:block>
                            <span class="govuk-visually-hidden" th:text="| #{${row.label}}|"></span>
                        </a>

                        <span th:if="${!row.isAssessableAndUnassessed}"
                              th:text="${@ThymeleafUtils.getFormattedValue(row.assessed).resolve(#messages)}"/>
                    </td>

                    <td class="govuk-table__cell">
                        <th:block th:if="${row.isAssessableAndAssessed()}">
                            <a th:href="${row.getChangeUrl(submissionId, claimId)}"
                               th:id="${row.id}"
                               th:data-testid="${'totals-' + row.key}"
                               class="govuk-link govuk-link--no-visited-state">
                                <th:block th:text="${@ThymeleafUtils.getChangeLinkText(row).resolve(#messages)}"></th:block>
                                <span class="govuk-visually-hidden" th:text="| #{${row.label}}|"></span>
                            </a>
                        </th:block>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div class="govuk-summary-card">
        <div class="govuk-summary-card__title-wrapper">
            <h2 class="govuk-summary-card__title" th:text="#{claimSummary.allowedTotalsTableTitle}"/>
        </div>
        <div class="govuk-summary-card__content">
            <table class="govuk-table govuk-!-margin-bottom-0">
                <colgroup>
                    <col class="govuk-table__row-item">
                    <col class="govuk-table__row-values">
                    <col class="govuk-table__row-values">
                    <col class="govuk-table__row-values">
                    <col class="govuk-table__row-actions">
                </colgroup>
                <thead class="govuk-table__head">
                    <tr class="govuk-table__row">
                        <th scope="col" class="govuk-table__header" th:text="#{claimSummary.item}"></th>
                        <th scope="col" class="govuk-table__header" th:text="#{claimSummary.calculated}"></th>
                        <th scope="col" class="govuk-table__header" th:text="#{claimSummary.submitted}"></th>
                        <th scope="col" class="govuk-table__header" th:text="#{claimSummary.allowed}"></th>
                        <th scope="col" class="govuk-table__header"></th>
                    </tr>
                </thead>
                <tbody class="govuk-table__body">
                <tr class="govuk-table__row"
                    th:each="row : ${viewModel.allowedTotals}"
                    th:with="
                    assessed=${row.isAssessed()},
                    assessableUnassessed=${row.isAssessableAndUnassessed()},
                    assessableAssessed=${row.isAssessableAndAssessed()}">

                    <td class="govuk-table__cell govuk-!-font-weight-bold"
                        th:text="#{${row.label}}">
                    </td>

                    <td class="govuk-table__cell"
                        th:text="${@ThymeleafUtils.getFormattedValue(row.calculated).resolve(#messages)}">
                    </td>

                    <td class="govuk-table__cell"
                        th:text="${@ThymeleafUtils.getFormattedValue(row.submitted).resolve(#messages)}">
                    </td>

                    <td class="govuk-table__cell">
                        <th:block th:if="${assessed}">
                            <span th:text="${@ThymeleafUtils.getFormattedValue(row.assessed).resolve(#messages)}"></span>
                        </th:block>

                        <th:block th:if="${assessableUnassessed}">
                            <a th:href="${row.getChangeUrl(submissionId, claimId)}"
                               th:id="${row.id}"
                               th:data-testid="${'totals-' + row.key}"
                               class="govuk-link govuk-link--no-visited-state">
                                <th:block th:text="${@ThymeleafUtils.getChangeLinkText(row).resolve(#messages)}"></th:block>
                                <span class="govuk-visually-hidden" th:text="| #{${row.label}}|"></span>
                            </a>
                        </th:block>
                    </td>

                    <td class="govuk-table__cell">
                        <th:block th:if="${assessableAssessed}">
                            <a th:href="${row.getChangeUrl(submissionId, claimId)}"
                               th:id="${row.id}"
                               th:data-testid="${'totals-' + row.key}"
                               class="govuk-link govuk-link--no-visited-state">
                                <th:block th:text="${@ThymeleafUtils.getChangeLinkText(row).resolve(#messages)}"></th:block>
                                <span class="govuk-visually-hidden" th:text="| #{${row.label}}|"></span>
                            </a>
                        </th:block>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

    <form th:action="@{/submissions/{submissionId}/claims/{claimId}/review(submissionId=${submissionId}, claimId=${claimId})}" method="post">
        <div class="govuk-button-group">
            <button class="govuk-button" type="submit" data-module="govuk-button" th:text="#{claimReview.submit}"></button>

            <a th:href="@{/submissions/{submissionId}/claims/{claimId}/discard(submissionId=${submissionId}, claimId=${claimId})}"
               id="discard"
               class="govuk-button govuk-button--secondary govuk-button--warning"
               data-module="govuk-button"
               th:text="#{claimReview.discard}"></a>
        </div>
    </form>
</main>
</body>
</html>
