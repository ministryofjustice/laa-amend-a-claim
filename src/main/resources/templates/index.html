<!DOCTYPE html >
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout :: layout(
        title=#{index.title},
        mainContent=~{::#main-content},
        pageCategory='search',
        showBackLink=${false}
    )}">
    <body>
        <main class="govuk-main-wrapper" id="main-content">
            <form th:action="@{/}" th:object="${form}" method="post">

                <th:block th:replace="~{partials/error-summary :: error-summary(${@ThymeleafUtils.sortSearchErrors(#fields.detailedErrors())})}"></th:block>

                <fieldset class="govuk-fieldset" aria-describedby="search-hint">
                    <legend class="govuk-fieldset__legend govuk-fieldset__legend--l">
                        <h1 class="govuk-fieldset__heading" th:text="#{index.heading}"></h1>
                    </legend>

                    <div id="search-hint" class="govuk-hint" th:text="#{index.hint}"></div>

                    <div class="search-panel">
                        <div th:replace="partials/text-input :: textInput('providerAccountNumber', 'provider-account-number', 'index.providerAccountNumber', 'govuk-!-width-one-half', 'text', true)"></div>

                        <div class="govuk-form-group" th:classappend="${#fields.hasErrors('submissionDateMonth') || #fields.hasErrors('submissionDateYear') ? 'govuk-form-group--error' : ''}">
                            <fieldset class="govuk-fieldset" role="group" aria-describedby="submission-date-hint">
                                <legend class="govuk-fieldset__legend govuk-fieldset__legend--s" th:text="#{index.submissionDate}"></legend>
                                <div id="submission-date-hint" class="govuk-hint" th:text="#{index.submissionDate.hint}"></div>
                                <p th:if="${#fields.hasErrors('submissionDateMonth') && #fields.hasErrors('submissionDateYear')}" class="govuk-error-message" th:errors="*{submissionDateMonth}">
                                    <span class="govuk-visually-hidden" th:text="#{form.error}"></span>
                                </p>
                                <p th:if="${#fields.hasErrors('submissionDateMonth') && !#fields.hasErrors('submissionDateYear')}" class="govuk-error-message" th:errors="*{submissionDateMonth}">
                                    <span class="govuk-visually-hidden" th:text="#{form.error}"></span>
                                </p>
                                <p th:if="${!#fields.hasErrors('submissionDateMonth') && #fields.hasErrors('submissionDateYear')}" class="govuk-error-message" th:errors="*{submissionDateYear}">
                                    <span class="govuk-visually-hidden" th:text="#{form.error}"></span>
                                </p>
                                <div class="govuk-date-input">
                                    <div class="govuk-date-input__item">
                                        <div th:replace="partials/text-input :: textInput('submissionDateMonth', 'submission-date-month', 'index.submissionDate.month', 'govuk-input--width-2', 'numeric', false)"></div>
                                    </div>
                                    <div class="govuk-date-input__item">
                                        <div th:replace="partials/text-input :: textInput('submissionDateYear', 'submission-date-year', 'index.submissionDate.year', 'govuk-input--width-4', 'numeric', false)"></div>
                                    </div>
                                </div>
                            </fieldset>
                        </div>

                        <div th:replace="partials/text-input :: textInput('uniqueFileNumber', 'unique-file-number', 'index.uniqueFileNumber', 'govuk-!-width-one-half', 'text', true)"></div>

                        <div th:replace="partials/text-input :: textInput('caseReferenceNumber', 'case-reference-number', 'index.caseReferenceNumber', 'govuk-!-width-one-half', 'text', true)"></div>

                        <div class="govuk-button-group">
                            <button type="submit" class="govuk-button" data-module="govuk-button" th:text="#{index.search}"></button>
                            <a class="govuk-link" th:href="@{/}" th:text="#{index.clear}"></a>
                        </div>
                    </div>
                </fieldset>
            </form>

            <th:block th:if="${viewModel != null}">
                <th:block th:if="${viewModel.claims.isEmpty()}">
                    <h2 class="govuk-heading-m" th:text="#{index.results.none}"></h2>

                    <p class="govuk-body" th:text="#{index.results.retry}"></p>
                </th:block>

                <th:block th:unless="${viewModel.claims.isEmpty()}">
                    <h2 class="govuk-heading-m" th:text="#{index.results.searchResults(${viewModel.pagination.results.count})}"></h2>

                    <table class="govuk-table">
                        <thead class="govuk-table__head">
                            <tr class="govuk-table__row">
                                <th:block th:replace="~{partials/sortable-header :: sortableHeader(${form}, ${sorts}, 'uniqueFileNumber', 'index.results.uniqueFileNumber')}"></th:block>

                                <th:block th:replace="~{partials/sortable-header :: sortableHeader(${form}, ${sorts}, 'caseReferenceNumber', 'index.results.caseReferenceNumber')}"></th:block>

                                <th scope="col" class="govuk-table__header" th:text="#{index.results.clientSurname}"></th>

                                <th scope="col" class="govuk-table__header" th:text="#{index.results.dateSubmitted}"></th>

                                <th:block th:replace="~{partials/sortable-header :: sortableHeader(${form}, ${sorts}, 'scheduleReference', 'index.results.account')}"></th:block>

                                <th scope="col" class="govuk-table__header" th:text="#{index.results.type}"></th>

                                <th scope="col" class="govuk-table__header" th:text="#{index.results.escaped}"></th>
                            </tr>
                        </thead>
                        <tbody class="govuk-table__body">
                            <tr class="govuk-table__row" th:each="claim : ${viewModel.claims}">
                                <td class="govuk-table__cell">
                                    <a th:href="@{/submissions/{submissionId}/claims/{claimId}(submissionId=${claim.submissionId}, claimId=${claim.claimId})}" th:text="${claim.uniqueFileNumber}" class="govuk-link govuk-link--no-visited-state"></a>
                                </td>
                                <td class="govuk-table__cell">
                                    <a th:href="@{/submissions/{submissionId}/claims/{claimId}(submissionId=${claim.submissionId}, claimId=${claim.claimId})}" th:text="${claim.caseReferenceNumber}" class="govuk-link govuk-link--no-visited-state"></a>
                                </td>
                                <td class="govuk-table__cell" th:text="${claim.clientSurname}"></td>
                                <td class="govuk-table__cell" th:text="${claim.submissionPeriodForDisplay}" th:data-sort-value="${claim.submissionPeriodForSorting}"></td>
                                <td class="govuk-table__cell" th:text="${claim.accountNumber}"></td>
                                <td class="govuk-table__cell" th:text="${claim.categoryOfLaw}"></td>
                                <td class="govuk-table__cell" th:with="value=${claim.escapedForDisplay}">
                                    <th:block th:if="${claim.escaped}">
                                        <strong class="govuk-tag govuk-tag--red" th:text="#{${value}}"></strong>
                                    </th:block>
                                    <th:block th:unless="${claim.escaped}">
                                        <span th:text="#{${value}}"></span>
                                    </th:block>
                                </td>
                            </tr>
                        </tbody>
                    </table>

                    <th:block th:replace="~{partials/pagination :: pagination(${viewModel.pagination})}"></th:block>
                </th:block>
            </th:block>
        </main>
    </body>
</html>
